# Mini Ledger

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω—ã–µ –±–∞–ª–∞–Ω—Å—ã** - –ö–∞–∂–¥—ã–π –º–µ—Ä—á–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –±–∞–ª–∞–Ω—Å—ã –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞–ª—é—Ç–∞—Ö
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã** - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Idempotency-Key
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π** - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏** - Redis —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ + —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î
- **Async/await** - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (API ‚Üí Service ‚Üí Repository)
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã** - Unit, integration –∏ concurrency —Ç–µ—Å—Ç—ã

---

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd mini-ledger

# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f app
```

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **API**: http://localhost:8000
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs
---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ä—á–∞–Ω—Ç–∞

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞ —Å –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–µ–π.

```bash
POST /merchants
{
  "name": "1 merchant",
  "percent_fee": 2.0
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": 200,
  "result": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "1 merchant",
    "percent_fee": "2.00",
    "created": "2025-01-01T12:00:00Z",
    "updated": "2025-01-01T12:00:00Z",
    "archived": false
  }
}
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ä—á–∞–Ω—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏

–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ä—á–∞–Ω—Ç–µ —Å–æ –≤—Å–µ–º–∏ –µ–≥–æ –±–∞–ª–∞–Ω—Å–∞–º–∏.

```bash
GET /merchants/{merchant_name}
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl http://localhost:8000/merchants/ryan_gosling
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": 200,
  "result": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "ryan_gosling",
    "percent_fee": "2.00",
    "balances": [
      {
        "id": "...",
        "merchant_id": "550e8400-e29b-41d4-a716-446655440000",
        "currency": "BTC",
        "amount": "1.50000000"
      },
      {
        "id": "...",
        "merchant_id": "550e8400-e29b-41d4-a716-446655440000",
        "currency": "USD",
        "amount": "1000.00000000"
      }
    ]
  }
}
```

---

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

–°–æ–∑–¥–∞—Ç—å –±–∞–ª–∞–Ω—Å –¥–ª—è –º–µ—Ä—á–∞–Ω—Ç–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –≤–∞–ª—é—Ç–µ.

```bash
POST /merchants/balance

{
  "merchant_id": "550e8400-e29b-41d4-a716-446655440000",
  "currency": "BTC",
  "initial_amount": 1.0
}
```

---

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ –º–µ—Ä—á–∞–Ω—Ç–∞

–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞.

```bash
GET /merchants/{merchant_name}/balance
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl http://localhost:8000/merchants/alice/balance
```

---

### 5. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞

–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É –º–µ—Ä—á–∞–Ω—Ç–∞–º–∏.


```bash
POST /transfers
Idempotency-Key: unique-key-123

{
  "from_merchant": "ryan_gosling",
  "to_merchant": "vasya_pupkin",
  "amount": 0.1,
  "currency": "BTC"
}
```

- –ó–∞–≥–æ–ª–æ–≤–æ–∫ `Idempotency-Key` **–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**
- –ö–æ–º–∏—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ `Idempotency-Key` –≤–µ—Ä–Ω—ë—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä —Å curl:**
```bash
curl -X POST http://localhost:8000/transfers \
  -H "Content-Type: application/json" \
  -H "Idempotency-Key: abc-123-xyz" \
  -d '{
    "from_merchant": "alice",
    "to_merchant": "bob",
    "amount": 0.1,
    "currency": "BTC"
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": 200,
  "result": {
    "id": "...",
    "from_merchant_id": "...",
    "to_merchant_id": "...",
    "amount": "0.10000000",
    "percent_fee": "2.00",
    "currency": "BTC",
    "idempotency_key": "abc-123-xyz",
    "created": "2025-01-01T12:00:00Z"
  }
}
```

---

### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏.

```bash
GET /transfers?from={merchant}&to={merchant}&currency={currency}
```

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –í—Å–µ –ø–µ—Ä–µ–≤–æ–¥—ã
curl http://localhost:8000/transfers

# –ü–µ—Ä–µ–≤–æ–¥—ã –æ—Ç alice
curl http://localhost:8000/transfers?from=alice

# –ü–µ—Ä–µ–≤–æ–¥—ã –∫ bob
curl http://localhost:8000/transfers?to=bob

# –¢–æ–ª—å–∫–æ BTC –ø–µ—Ä–µ–≤–æ–¥—ã
curl http://localhost:8000/transfers?currency=BTC

# –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
curl http://localhost:8000/transfers?from=alice&to=bob&currency=BTC
```

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  API Layer (FastAPI)                            ‚îÇ
‚îÇ  - HTTP –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è                           ‚îÇ
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ (Pydantic)       ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Service Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)                  ‚îÇ
‚îÇ  - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤                        ‚îÇ
‚îÇ  - –†–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π                              ‚îÇ
‚îÇ  - –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–æ–≤                           ‚îÇ
‚îÇ  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è Redis –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Repository Layer (–î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º)             ‚îÇ
‚îÇ  - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤                      ‚îÇ
‚îÇ  - –û–ø–µ—Ä–∞—Ü–∏–∏ SQLAlchemy Core                     ‚îÇ
‚îÇ  - –ú–∞–ø–ø–∏–Ω–≥ –æ—à–∏–±–æ–∫ (DB ‚Üí Domain –∏—Å–∫–ª—é—á–µ–Ω–∏—è)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Infrastructure Layer                           ‚îÇ
‚îÇ  - PostgreSQL (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)         ‚îÇ
‚îÇ  - Redis (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)            ‚îÇ
‚îÇ  - Alembic (–º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î)                        ‚îÇ
‚îÇ  - Structured logging (JSON)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|------------|
| **Web Framework** | FastAPI | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP API |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | PostgreSQL 16 | –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ |
| **DB Driver** | asyncpg | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π PostgreSQL –¥—Ä–∞–π–≤–µ—Ä |
| **ORM** | SQLAlchemy Core | Type-safe SQL –∑–∞–ø—Ä–æ—Å—ã |
| **–ú–∏–≥—Ä–∞—Ü–∏–∏** | Alembic | –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã –ë–î |
| **Cache/Locks** | Redis  | –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | Pydantic | –°—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | structlog | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ JSON –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |
| **–õ–∏–Ω—Ç–∏–Ω–≥** | Ruff | –ë—ã—Å—Ç—Ä—ã–π Python –ª–∏–Ω—Ç–µ—Ä |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | pytest + pytest-asyncio | –§—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ |

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ **–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç Idempotency-Key** –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞
2. **–°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç**, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–µ—Ä–µ–≤–æ–¥ —Å —ç—Ç–∏–º –∫–ª—é—á–æ–º
3. **–ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Üí –í–µ—Ä–Ω—É—Ç—å –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –ë–î
4. **–ï—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç** ‚Üí –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å –∫–ª—é—á–æ–º
5. **–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ** –Ω–∞ `idempotency_key` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–°–±–æ–∏ —Å–µ—Ç–∏** - –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –Ω–µ—É–¥–∞–≤—à–∏–µ—Å—è –∑–∞–ø—Ä–æ—Å—ã
- **Retry –∫–ª–∏–µ–Ω—Ç–∞** - –î—É–±–ª–∏—Ä—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã
- **Exactly-once —Å–µ–º–∞–Ω—Ç–∏–∫–∞** - –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∫–ª—é—á –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

–°–∏—Å—Ç–µ–º–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –±–∞–ª–∞–Ω—Å–æ–≤** –∏ **–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** –¥–∞–∂–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

#### 1. Redis —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

```python
# –ó–∞—Ö–≤–∞—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è deadlock
lock_keys = sorted([
    f"merchant_balance_{from_merchant}_{currency}_transfer_lock",
    f"merchant_balance_{to_merchant}_{currency}_transfer_lock"
])

async with redis_lock(lock_keys[0]):
    async with redis_lock(lock_keys[1]):
        ...
```

#### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞

```python
# –í–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å —Å—Ä–µ–¥—Å—Ç–≤ –í–ö–õ–Æ–ß–ê–Ø –∫–æ–º–∏—Å—Å–∏—é
final_amount = amount + (amount / 100 * fee_percent)

if sender_balance < final_amount:
    raise InsufficientFundsError()
```

### –ì–∞—Ä–∞–Ω—Ç–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ó–∞—â–∏—Ç–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|--------|-----------|
| **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –æ—Ç –æ–¥–Ω–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞** | Redis –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ |
| **–î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã (A‚ÜíB, B‚ÜíA)** | –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ | –ù–µ—Ç deadlock |
| **Race condition –Ω–∞ –±–∞–ª–∞–Ω—Å** | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–î + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤** | –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π |

---

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–≤–∞–ª—é—Ç–Ω–æ—Å—Ç–∏

### –î–∏–∑–∞–π–Ω –≤–∞–ª—é—Ç

- –ö–∞–∂–¥—ã–π –º–µ—Ä—á–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –±–∞–ª–∞–Ω—Å–æ–≤** –≤ —Ä–∞–∑–Ω—ã—Ö –≤–∞–ª—é—Ç–∞—Ö
- –ö–∞–∂–¥—ã–π –±–∞–ª–∞–Ω—Å **–Ω–µ–∑–∞–≤–∏—Å–∏–º** (BTC, USD, EUR –∏ —Ç.–¥.)
- –ü–µ—Ä–µ–≤–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã** (–Ω–µ—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## –†–∞—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∏—Å—Å–∏–π

- **–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ä—á–∞–Ω—Ç–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2%)
- **–°–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è** (–Ω–µ —Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è)
- **–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ —Å—É–º–º–µ –ø–µ—Ä–µ–≤–æ–¥–∞**

### –§–æ—Ä–º—É–ª–∞

```python
transfer_amount = 100
fee_percent = 2.0

fee = transfer_amount * (fee_percent / 100)  # 2
total_deducted = transfer_amount + fee       # 102

sender_balance -= total_deducted  # -102
receiver_balance += transfer_amount  # +100
```
---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
pytest
```
### –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã

#### –¢–µ—Å—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
```python
# –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ idempotency key –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
response1 = await create_transfer(idempotency_key="test-123")
response2 = await create_transfer(idempotency_key="test-123")

assert response1.json() == response2.json()
```

#### –¢–µ—Å—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏
```python
# 5 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–æ 250 USD –ø—Ä–∏ –±–∞–ª–∞–Ω—Å–µ 1000
results = await asyncio.gather(*[
    create_transfer(amount=250, key=f"concurrent-{i}")
    for i in range(5)
])

# –ß–∞—Å—Ç—å —É—Å–ø–µ—à–Ω—ã—Ö, —á–∞—Å—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã—Ö
# –ë–∞–ª–∞–Ω—Å –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π
assert balance >= 0
```

---

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
mini-ledger/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/           # HTTP —Å–ª–æ–π (—Ä–æ—É—Ç–µ—Ä—ã, —Å—Ö–µ–º—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ merchants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transfers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py
‚îÇ   ‚îú‚îÄ‚îÄ logic/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Å–µ—Ä–≤–∏—Å—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ merchants/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ balances/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transfers/
‚îÇ   ‚îú‚îÄ‚îÄ infra/         # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db/        # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (repos, models, alembic)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis/     # Redis (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logging.py # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ domain/        # –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ main.py        # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ tests/             # –¢–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ README.md
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ö–æ–º–∞–Ω–¥—ã Makefile
make up          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make down        # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
make logs-all    # –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make shell-app   # –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make shell-db    # –í–æ–π—Ç–∏ –≤ PostgreSQL
make shell-redis # –í–æ–π—Ç–∏ –≤ Redis CLI
make lint        # –ó–∞–ø—É—Å—Ç–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä
make clean       # –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ volumes
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–º. `.env.example` –¥–ª—è –≤—Å–µ—Ö –æ–ø—Ü–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
POSTGRES_DB=mini_ledger
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Redis
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
JSON_LOGS=true
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ HTTP –∫–æ–¥–∞–º–∏.

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ–± –æ—à–∏–±–∫–µ

```json
{
  "status": 400,
  "error": "Insufficient funds"
}
```

### HTTP –∫–æ–¥—ã —Å—Ç–∞—Ç—É—Å–∞

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|--------|
| **200** | –£—Å–ø–µ—Ö | –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω |
| **400** | –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤, –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ |
| **404** | –ù–µ –Ω–∞–π–¥–µ–Ω–æ | –ú–µ—Ä—á–∞–Ω—Ç –∏–ª–∏ –±–∞–ª–∞–Ω—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç |
| **409** | –ö–æ–Ω—Ñ–ª–∏–∫—Ç | –î—É–±–ª–∏—Ä—É—é—â–µ–µ –∏–º—è –º–µ—Ä—á–∞–Ω—Ç–∞ |
| **422** | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ |
| **500** | –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ | –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ |

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

```bash
# –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
{
  "status": 400,
  "error": "Insufficient funds"
}

# –ú–µ—Ä—á–∞–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
{
  "status": 404,
  "error": "From merchant or to merchant does not exist"
}

# –ë–∞–ª–∞–Ω—Å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
{
  "status": 404,
  "error": "From merchant balance with currency BTC does not exist"
}

# –ü–µ—Ä–µ–≤–æ–¥ —Å–∞–º–æ–º—É —Å–µ–±–µ
{
  "status": 422,
  "error": ["Cannot transfer to the same merchant"]
}

# –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç idempotency key
{
  "status": 422,
  "error": ["Field required"]
}
```
---

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

1. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫—É—Ä—Å–∞–º–∏ –æ–±–º–µ–Ω–∞
2. **–¢–∞—Ä–∏—Ñ—ã –∫–æ–º–∏—Å—Å–∏–π** - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—ä—ë–º–∞
3. **–õ–∏–º–∏—Ç—ã –º–µ—Ä—á–∞–Ω—Ç–æ–≤** - –î–Ω–µ–≤–Ω—ã–µ/–º–µ—Å—è—á–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤
4. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API** - `/v1/`, `/v2/` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
5. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
6. **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Prometheus/Grafana
7. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –º–µ—Ä—á–∞–Ω—Ç–∞